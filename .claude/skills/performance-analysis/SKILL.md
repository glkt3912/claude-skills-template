---
name: performance-analysis
description: パフォーマンスを調査・分析する。「パフォーマンス調査」「遅い原因」「ボトルネック特定」などの依頼時に使用。
---

# 目的

アプリケーションのパフォーマンス問題を特定し、改善策を提案する。

# 手順

1. **問題の定義**
   - 何が遅いか（ページ読み込み、API応答、処理時間）
   - どの程度遅いか（数値で把握）
   - いつから遅いか

2. **計測**
   - 現状のパフォーマンス数値を取得
   - ベースラインとの比較

3. **ボトルネック特定**
   - プロファイリング結果の分析
   - ホットスポットの特定

4. **改善策の提案**
   - 費用対効果の高い順に提案
   - トレードオフの説明

# パフォーマンス指標

## フロントエンド

| 指標 | 目標 | 説明 |
| ---- | ---- | ---- |
| LCP | < 2.5s | Largest Contentful Paint |
| FID | < 100ms | First Input Delay |
| CLS | < 0.1 | Cumulative Layout Shift |
| TTFB | < 800ms | Time to First Byte |
| Bundle Size | 最小限 | JavaScript バンドルサイズ |

## バックエンド

| 指標 | 目標 | 説明 |
| ---- | ---- | ---- |
| Response Time | < 200ms | API 応答時間（p95） |
| Throughput | 高いほど良い | 秒間リクエスト数 |
| Error Rate | < 1% | エラー率 |
| CPU Usage | < 70% | CPU 使用率 |
| Memory Usage | 安定 | メモリ使用量 |

## データベース

| 指標 | 目標 | 説明 |
| ---- | ---- | ---- |
| Query Time | < 100ms | クエリ実行時間 |
| Connection Pool | 適切 | コネクション使用率 |
| Index Usage | 高い | インデックス使用率 |

# よくあるボトルネック

| 箇所 | 症状 | 対処 |
| ---- | ---- | ---- |
| N+1 クエリ | DB クエリ数が多い | JOIN, Eager Loading |
| 大量データ処理 | メモリ使用量増大 | ストリーミング、ページネーション |
| 同期処理 | レスポンス遅延 | 非同期化、キュー |
| 未インデックス | クエリが遅い | インデックス追加 |
| 無駄な再レンダリング | UI がもたつく | メモ化、状態設計見直し |
| 大きなバンドル | 初期読み込み遅い | コード分割、遅延読み込み |
| 画像最適化不足 | 読み込み遅い | 圧縮、WebP、lazy loading |

# 調査ツール

| カテゴリ | ツール |
| -------- | ------ |
| フロントエンド | Chrome DevTools, Lighthouse, WebPageTest |
| Node.js | clinic.js, 0x, node --inspect |
| Python | cProfile, py-spy, memory_profiler |
| DB | EXPLAIN ANALYZE, slow query log |
| 全般 | APM（Datadog, New Relic） |

# 出力フォーマット

```markdown
## パフォーマンス分析レポート

### 問題の概要
- **症状**: [何が遅いか]
- **影響**: [ユーザー体験への影響]
- **現状値**: [計測値]

### ボトルネック

#### 1. [問題箇所1]
- **場所**: `ファイル:行番号`
- **原因**: [なぜ遅いか]
- **影響度**: 高/中/低
- **改善案**: [具体的な対処]
- **期待効果**: [どの程度改善するか]

### 推奨対応（優先順）
1. [最も効果的な対応]
2. [次に効果的な対応]

### 計測方法
[改善効果の確認方法]
```

# 制約

- 推測ではなく計測に基づく
- 早すぎる最適化を避ける
- トレードオフを明示
