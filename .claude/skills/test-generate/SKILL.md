---
name: test-generate
description: テストコードを生成する。「テスト作成」「ユニットテスト書いて」「カバレッジ向上」などの依頼時に使用。
---

# 目的

対象コードに対する包括的なテストを生成する。

# 手順

1. **対象コードの分析**
   - 関数/クラスの責務を理解
   - 入力/出力、副作用を特定
   - 依存関係を把握

2. **テスト戦略の決定**
   - 単体テスト / 統合テスト / E2E テストの選択
   - モック/スタブの必要性判断

3. **テストケース設計**
   - 正常系、異常系、境界値
   - エッジケースの洗い出し

4. **テストコード生成**
   - プロジェクトのテストパターンに従う
   - AAA パターン（Arrange-Act-Assert）で記述

# テストケースの観点

| 観点 | 例 |
| ---- | -- |
| 正常系 | 期待通りの入力で期待通りの出力 |
| 異常系 | 不正な入力でエラーハンドリング |
| 境界値 | 最小値、最大値、0、空文字、null |
| エッジケース | 配列が空、1要素、大量要素 |
| 状態遷移 | 初期状態、状態変更後 |

# AAA パターン

```typescript
describe('calculateTotal', () => {
  it('should calculate total with tax', () => {
    // Arrange: 準備
    const items = [{ price: 100 }, { price: 200 }];
    const taxRate = 0.1;

    // Act: 実行
    const result = calculateTotal(items, taxRate);

    // Assert: 検証
    expect(result).toBe(330);
  });
});
```

# モック戦略

| 依存の種類 | 方針 |
| ---------- | ---- |
| 外部 API | 必ずモック |
| データベース | 単体テストではモック、統合テストでは実 DB |
| ファイルシステム | 単体テストではモック |
| 時刻 | 固定値に差し替え |
| 乱数 | シード固定またはモック |

# 出力フォーマット

既存のテストファイルのパターンに従う。パターンが見つからない場合は以下を使用:

```typescript
import { describe, it, expect, vi } from 'vitest';
// または
import { describe, it, expect, jest } from '@jest/globals';
```

# 制約

- 実装の詳細ではなく、振る舞いをテスト
- テスト同士は独立させる（順序依存を避ける）
- テストコードも可読性を重視
- 過度なモックは避ける
