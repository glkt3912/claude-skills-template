---
name: security-audit
description: セキュリティ監査を実施する。「セキュリティチェック」「脆弱性を探して」「セキュリティレビュー」などの依頼時に使用。
---

# 目的

OWASP Top 10 を中心としたセキュリティ観点でコードを監査する。

# 手順

1. **対象の特定**
   - 監査対象のファイル・機能を確認
   - 技術スタック（フレームワーク、ライブラリ）を把握

2. **脆弱性チェック**
   - OWASP Top 10 に基づく検査
   - フレームワーク固有の脆弱性パターン確認

3. **レポート作成**
   - 発見した脆弱性を重要度別に分類
   - 修正方法を具体的に提示

# チェック項目（OWASP Top 10 ベース）

| カテゴリ | チェック内容 |
| -------- | ------------ |
| インジェクション | SQL, NoSQL, OS コマンド, LDAP インジェクション |
| 認証の不備 | セッション管理、パスワード処理、トークン管理 |
| 機密データの露出 | 暗号化、ログ出力、エラーメッセージ |
| XXE | XML 外部エンティティ参照 |
| アクセス制御の不備 | 認可チェック、権限昇格 |
| セキュリティ設定ミス | デフォルト設定、不要な機能 |
| XSS | 反射型、格納型、DOM ベース |
| 安全でないデシリアライズ | オブジェクト復元の検証 |
| 既知の脆弱性 | 依存ライブラリのバージョン |
| 不十分なロギング | 監査ログ、アラート |

# 出力フォーマット

```markdown
## セキュリティ監査レポート

### サマリー
- Critical: X件
- High: X件
- Medium: X件
- Low: X件

### 発見事項

#### [Critical] CWE-89: SQL Injection
- **場所**: `src/api/users.ts:45`
- **問題**: ユーザー入力が直接 SQL クエリに結合
- **影響**: データベースの不正操作、情報漏洩
- **修正方法**: パラメータ化クエリを使用
  ```typescript
  // Before
  db.query(`SELECT * FROM users WHERE id = ${userId}`)
  // After
  db.query('SELECT * FROM users WHERE id = ?', [userId])
  ```

...
```

# 制約

- 誤検知を減らすため、文脈を考慮して判断
- 修正方法は具体的なコード例を提示
- フレームワークの保護機能を考慮
