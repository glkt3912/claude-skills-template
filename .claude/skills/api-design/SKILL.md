---
name: api-design
description: REST/GraphQL API を設計する。「API設計」「エンドポイント設計」「API仕様を作成」などの依頼時に使用。
---

# 目的

RESTful または GraphQL の API を設計し、仕様書を作成する。

# 手順

1. **要件の整理**
   - 必要なリソース・操作を洗い出し
   - クライアントの利用パターンを想定

2. **設計方針の決定**
   - REST vs GraphQL の選択
   - 認証方式（JWT, OAuth, API Key）
   - バージョニング戦略

3. **エンドポイント設計**
   - URL 構造、HTTP メソッド
   - リクエスト/レスポンス形式
   - エラーハンドリング

4. **仕様書作成**
   - OpenAPI (Swagger) 形式で出力

# REST 設計原則

| 原則 | 説明 |
| ---- | ---- |
| リソース指向 | 名詞を使用（`/users`）、動詞は避ける |
| HTTP メソッド | GET（取得）, POST（作成）, PUT（更新）, DELETE（削除） |
| ステータスコード | 適切な HTTP ステータスを返す |
| 一貫性 | 命名規則、レスポンス形式を統一 |

# レスポンス形式

```json
{
  "data": { ... },
  "meta": {
    "page": 1,
    "total": 100
  }
}
```

# エラーレスポンス形式

```json
{
  "error": {
    "code": "VALIDATION_ERROR",
    "message": "入力値が不正です",
    "details": [
      { "field": "email", "message": "有効なメールアドレスを入力してください" }
    ]
  }
}
```

# HTTP ステータスコード

| コード | 用途 |
| ------ | ---- |
| 200 | 成功（GET, PUT） |
| 201 | 作成成功（POST） |
| 204 | 成功、レスポンスなし（DELETE） |
| 400 | リクエスト不正 |
| 401 | 認証エラー |
| 403 | 権限エラー |
| 404 | リソース未発見 |
| 422 | バリデーションエラー |
| 500 | サーバーエラー |

# 出力

`templates/openapi.yaml.tpl` を参照して OpenAPI 仕様を生成。

# 制約

- RESTful の原則に従う
- 過度な設計を避け、YAGNI を意識
- クライアント視点で使いやすさを重視
