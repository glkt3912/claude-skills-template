---
name: log-analysis
description: ログやスタックトレースを解析する。「ログ解析」「エラーログ見て」「スタックトレース解析」などの依頼時に使用。
---

# 目的

エラーログ、スタックトレース、アプリケーションログを解析し、問題の原因を特定する。

# 手順

1. **ログの種類を特定**
   - エラーログ / アクセスログ / アプリケーションログ
   - ログフォーマット（JSON, 構造化, プレーンテキスト）

2. **エラー情報の抽出**
   - エラーメッセージ
   - スタックトレース
   - タイムスタンプ、リクエストID

3. **コンテキストの把握**
   - エラー発生前後のログ
   - 関連するリクエスト/処理

4. **原因の特定**
   - スタックトレースから発生箇所を特定
   - エラーパターンとの照合

# スタックトレースの読み方

```
Error: Cannot read property 'id' of undefined
    at getUserById (/app/src/services/user.ts:45:12)    ← 直接の発生箇所
    at async getProfile (/app/src/handlers/profile.ts:23:18)
    at async Router.handle (/app/node_modules/...)
```

| 要素 | 説明 |
| ---- | ---- |
| エラーメッセージ | 1行目。何が起きたか |
| 発生箇所 | 最上部のスタック。直接の原因 |
| 呼び出し元 | 下に行くほど呼び出し元 |
| ファイル:行:列 | 正確な位置 |

# よくあるエラーパターン

| パターン | 原因 | 対処 |
| -------- | ---- | ---- |
| `Cannot read property 'x' of undefined` | null/undefined アクセス | オプショナルチェーン、事前チェック |
| `ECONNREFUSED` | 接続先が応答しない | サービス起動確認、ホスト名確認 |
| `ETIMEDOUT` | タイムアウト | タイムアウト値調整、処理最適化 |
| `ENOMEM` | メモリ不足 | メモリリーク調査、リソース増強 |
| `ENOSPC` | ディスク容量不足 | ログローテーション、不要ファイル削除 |
| `401 Unauthorized` | 認証エラー | トークン有効期限、認証情報確認 |
| `403 Forbidden` | 権限エラー | 権限設定確認 |
| `429 Too Many Requests` | レート制限 | リトライ実装、リクエスト頻度調整 |

# 出力フォーマット

```markdown
## ログ解析レポート

### エラー概要
- **種類**: [エラータイプ]
- **メッセージ**: [エラーメッセージ]
- **発生箇所**: `ファイル:行番号`
- **発生時刻**: [タイムスタンプ]

### 原因分析
[なぜこのエラーが発生したか]

### 影響範囲
[どの機能・ユーザーに影響があるか]

### 推奨対応
1. [対応策1]
2. [対応策2]

### 関連ログ
[前後のログや関連するエントリ]
```

# 制約

- 推測ではなくログの事実に基づく
- 機密情報（パスワード、トークン）はマスク
- 複数の可能性がある場合は列挙
